<!DOCTYPE html>
<html>
<header>{% include "header.html" %}


</header>
<body style="overflow: hidden;">
<!-- {#{% extends 'index.html' %}#} -->
{% load static %}

<!-- {#{% block title %}#}
{#    <title>ìì¬í˜„í™© ì¡°íšŒ</title>#}
{#{% endblock title %}#}
{##}
{#{% block content %}#} -->
<div class="spinner" id="spinner">
    <img src="../../../static/img/spinner.gif" width="150px" height="150px"/>
</div>

<div
        class="row no-gutters justify-content-center d-lg-none d-md-flex d-sm-flex"
>
    <h2 class="font-weight-bold my-2">ìì¬ì¬ê³ í˜„í™© ì¡°íšŒ</h2>
</div>

<!-- ê²€ìƒ‰ -->
<div class="card m-2">
    <div class="card-body p-2">
        <!-- ë³¸ë¬¸ -->
        <div
                class="content-search row no-gutters align-items-center content-input-group"
        >
            <form
                    class="col-11"
                    id="material_status_main-form"
                    onsubmit="nation1.page =1; return material_status_search_submit(event)"
            >
                <div class="row no-gutters">
                    <div class="content-input-group col-3 px-0">
                        <div class="content-input-group-header">
                            <label>ê±°ë˜ì²˜ëª…</label>
                        </div>
                        <div class="content-input-group-input">
                            <select
                                    class="form-control customer-dropdown"
                                    id="customer_search"
                                    name="customer_search"
                            ></select>
                        </div>
                    </div>
                    <div class="content-input-group col-3 px-0">
                        <div class="content-input-group-header">
                            <label>ë¸Œëœë“œ</label>
                        </div>
                        <div class="content-input-group-input">
                            <select
                                    class="form-control brand-dropdown-search"
                                    id="brand_search"
                                    name="brand_search"
                            ></select>
                        </div>
                    </div>
                    <div class="content-input-group col-3 px-0">
                        <div class="content-input-group-header">
                            <label>ì œí’ˆêµ°</label>
                        </div>
                        <div class="content-input-group-input">
                            <select
                                    class="form-control item_group-dropdown-search"
                                    id="item_group_search"
                                    name="item_group_search"
                            ></select>
                        </div>
                    </div>
                </div>
                <div class="row no-gutters">
                    <div class="content-input-group col-3 px-0">
                        <div class="content-input-group-header">
                            <label>í’ˆë²ˆ</label>
                        </div>
                        <div class="content-input-group-input">
                            <select
                                    class="form-control item-code-dropdown-search"
                                    id="item_code_search"
                                    name="item_code_search"
                            ></select>
                        </div>
                    </div>
                    <div class="content-input-group col-3 px-0">
                        <div class="content-input-group-header">
                            <label>ë‚˜ì´ìŠ¤ë²ˆí˜¸</label>
                        </div>
                        <div class="content-input-group-input">
                            <select
                                    class="form-control nice_number-dropdown-search"
                                    id="nice_number_search"
                                    name="nice_number_search"
                            ></select>
                        </div>
                    </div>
                    <div class="content-input-group col-3 px-0">
                        <div class="content-input-group-header">
                            <label>í’ˆëª©êµ¬ë¶„</label>
                        </div>
                        <div class="content-input-group-input">
                            <select
                                    class="form-control item_division-dropdown-search"
                                    id="item_division_search"
                                    name="item_division_search"
                            ></select>
                        </div>
                    </div>
                    <div class="content-input-group col-3 px-0">
                        <div class="content-input-group-header">
                            <label>ìˆ˜ëŸ‰ 0 ì œì™¸</label>
                        </div>
                        <div class="content-input-group-input">
                    <div class="form-control">

                        <input type="checkbox" class="w-100 align-center" id="stockzero" unchecked>

                    </div>
                        </div>
                    </div>
                </div>
                <div class="row no-gutters">
                      <div class="content-input-group col-4 mt-2">
                        <div class="content-input-group-input input-group">
                            <input class="form-control" id="multiSearch" placeholder="ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”
                            "/>
                          <div class="input-group-append">
                     <button class="btn btn-outline-secondary" type="button" onclick="nation1.page=1; search();"> ğŸ”</button>

                        </div>
                        </div>
                    </div>
                </div>
            </form>
            <div class="col-1 px-0 ml-auto">
                <button
                        class="btn button-search rounded-0 w-100 h-100"
                        type="submit"
                        form="material_status_main-form"
                >
                    ê²€ìƒ‰
                </button>
            </div>
        </div>
    </div>
</div>

<!-- í…Œì´ë¸” -->
<div class="card m-2">
    <div class="row no-gutters card-body p-2">
        <!-- ë³¸ë¬¸ -->
        <div class="content-table col-12" style="overflow-x: visible; height: 600px;">
            <table id="material_status_data-table" class="table table-sm text-center">
                <thead>
                <tr>
                    <th>ìˆœë²ˆ</th>
                    <th>ë¸Œëœë“œ</th>
                    <th>ì œí’ˆêµ°</th>
                    <th class="sorting_item_name" onclick="search('name')">í’ˆëª…</th>
                    <th class="sorting_item_code" onclick="search('code')">í’ˆë²ˆ</th>
                    <th class="sorting_item_nice" onclick="search('nice_number')">ë‚˜ì´ìŠ¤ë²ˆí˜¸</th>
                    <th>í’ˆëª…ìƒì„¸</th>
                    <th>í˜•íƒœ</th>
                    <th>ìì¬êµ¬ë¶„</th>
                    <th>ì…í•˜ìˆ˜ëŸ‰</th>
                    <th>ë¶ˆëŸ‰ìˆ˜ëŸ‰</th>
                    <th>ì…ê³ ìˆ˜ëŸ‰</th>
                    <th>ì¶œê³ ìˆ˜ëŸ‰</th>
                    <th>ë°˜ì…ìˆ˜ëŸ‰</th>
                    <th>ì¡°ì •ìˆ˜ëŸ‰</th>
                    <th>í˜„ì¬ê³ </th>
                    <th>ì°½ê³ ë³„ ì¬ê³ í˜„í™©</th>
                </tr>
                </thead>
                <tbody id="material-status-tbody"></tbody>
            </table>

            <div class="row no-gutters d-flex justify-content-center" id="item_nation"
                 style="margin-top: -20px;">
            </div>
{#                <div class="col-1 ml-auto">#}
{#                 <a href="#" id="excel-export" class="col-1 text-center">#}
{#                    <img src="/static/img/i_excel_c.png" width="38" height="38" />#}
{#                    <p class="mb-0">ì—‘ì…€ ë³€í™˜</p>#}
{#                </a>#}
{#                </div>#}

        </div>
    </div>
</div>
<!-- ëª¨ë‹¬ì°½ -->
<div class="card m-2">
    <div class="card-body">
        <div class="modal modal-center" id="locationModal" tabindex="-1" style="height:700px;" role="dialog">
            <div class="modal-dialog modal-xl modal-center ">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title font-weight-bold">ì°½ê³ ë“±ë¡</h5>
                    </div>
                    <div class="modal-body d-flex justify-content-center">
                        <div class="card m-2">
                            <div class="card-title">í’ˆëª©ì •ë³´</div>
                            <div class="card-body p-2 ">
                                <div class="p-2 m-2 content-table" style="overflow-y:hidden; height: 100px;">
                                    <table class="text-center">
                                        <thead>
                                        <tr>
                                            <th>ë¸Œëœë“œ</th>
                                            <th>ì œí’ˆêµ°</th>
                                            <th>í’ˆëª…</th>
                                            <th>í’ˆë²ˆ</th>
                                            <th>ë‚˜ì´ìŠ¤ë²ˆí˜¸</th>
                                            <th>í’ˆëª…ìƒì„¸</th>
                                            <th>í˜•íƒœ</th>
                                            <th>í˜„ì¬ê³ </th>
                                        </tr>
                                        </thead>
                                        <tbody id="itemInform"></tbody>
                                    </table>
                                </div>
                                <div class="card">
                                    <div class="card-title">ì°½ê³ ì •ë³´</div>
                                        <div class="card-body">
                                             <div class="card-body row" id="selectLocation" style="overflow-y:hidden;">
                                        </div>
                                    </div>
                                </div>
                                <div class="card">
                                    <div class="card-title">ì°½ê³  ì´ë™</div>
                                    <div class="card-body">
                                        <form id="material_modify_status">
                                            <div class="row no-gutters">
                                                <div class="content-input-group col-4 px-0">
                                                    <div class="content-input-group-header">
                                                        <label>ì¶œê³ ì°½ê³ </label>
                                                    </div>
                                                    <div class="content-input-group-input">
                                                        <select
                                                                class="form-control location-dropdown"
                                                                id="location_out"
                                                                name="location_out"
                                                        ></select>
                                                    </div>
                                                </div>
                                                <div class="content-input-group col-4 px-0">
                                                    <div class="content-input-group-header">
                                                        <label>ìˆ˜ëŸ‰</label>
                                                    </div>
                                                    <div class="content-input-group-input">
                                                        <input
                                                                class="form-control item-amount"
                                                                id="item-amount"
                                                                name="item-amount"
                                                        />
                                                    </div>
                                                </div>
                                                <div class="content-input-group col-4 px-0">
                                                    <div class="content-input-group-header">
                                                        <label>ì…ê³ ì°½ê³ </label>
                                                    </div>
                                                    <div class="content-input-group-input">
                                                        <select
                                                                class="form-control location-dropdown"
                                                                id="location_in"
                                                                name="location_in"
                                                        ></select>
                                                    </div>
                                                </div>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-primary" onclick="resetLocation()">ì´ˆê¸°í™”</button>
                        <button type="button" class="btn btn-secondary" form="material_modify_status"
                                onclick="enrollLocation()">ë“±ë¡
                        </button>
                        <button type="button" class="btn btn-danger" data-dismiss="modal">ë‚˜ê°€ê¸°</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="{% static 'js/api_materials.js' %}" type="text/javascript"></script>
<script src="{% static 'js/api_codemaster.js' %}" type="text/javascript"></script>
<script src="{% static 'js/api_paginations.js' %}" type="text/javascript"></script>
<script>

    let nation_data1 = {
        cname: 'nation1',  // ì¸ìŠ¤í„´ìŠ¤ ëª…ê³¼ ì¼ì¹˜í•´ì•¼í•¨
        table_id: 'item_nation',
        range: 5,
        page_size: 15,
    };

    let nation1 = new Pnations(nation_data1, search);  // ì¸ìŠ¤í„´ìŠ¤ ëª…

    $(".datepicker").datepicker({
        format: "yyyy-mm-dd",
        minViewMode: 0,
        maxViewMode: 2,
        autoclose: true,
        language: "ko",
    });

    let main_click_id = null;

    $(".datepicker").datepicker("setDate", "today");

    $(".input-daterange input").each(function () {
        $(this).datepicker({
            format: "yyyy-mm-dd",
            language: "ko",
        });
    });

    $(function () {
        set_naming();
        refresh();

        // Table Export
        $(parent.document).find("#excel-export").click(() =>
            init_excel_export($("#material_status_data-table"), "ì¬ê³ í˜„í™©")
        );
    });


    function set_naming() {
        let enterprise_name = get_userinfo().enterprise_name;
        if (enterprise_name == '(ì£¼)ê±´ê°•ìƒí™œì—°êµ¬ì†Œ') {
            $("#n_bom_model1").text("ì œí’ˆêµ°");
            $("#n_bom_model2").text("ì œí’ˆêµ°");
        }
    }


    function refresh() {
        material_status_init();
        search();
    }

    let order = ""


    function search(ordering) {
        let query = "?page=" + nation1.page + "&";

        let customer_search = $('#customer_search :selected').val();

        let brand = ($('#brand_search :selected').val() ? $('#brand_search :selected').val() : "");
        let item_group = ($('#item_group_search :selected').val() ? $('#item_group_search :selected').val() : "");
        let nice_number = ($('#nice_number_search :selected').val() ? $('#nice_number_search :selected').val() : "");
        {#let item_name = ($('#item_name_search :selected').val() ? $('#item_name_search :selected').val() : "");#}
        let item_code = ($('#item_code_search :selected').val() ? $('#item_code_search :selected').val() : "");
        let item_division = ($('#item_division_search :selected').val() ? $('#item_division_search :selected').val() : "");
        {#let detail = ($('#detail_search').val() ? $('#detail_search').val() : "");#}
        {#let shape = ($('#shape_search').val() ? $('#shape_search').val() : "");#}

        let multiSearch = $("#multiSearch").val()

       if (customer_search === '' || customer_search == null){
        } else {
            query += "customer=" + customer_search + "&";
        }

        if (brand !== '') query += "brand=" + brand + "&";
        if (item_group !== '') query += "item_group=" + item_group + "&";
        if (nice_number !== '') query += "nice_number=" + nice_number + "&";
        {#if (item_name !== '') query += "item_name=" + item_name + "&";#}
        if (item_code !== '') query += "item_code=" + item_code + "&";
        if (item_division !== '') query += "item_division=" + item_division + "&";
        {#if (detail !== '') query += "detail=" + detail + "&";#}
        {#if (shape !== '') query += "shape=" + shape + "&";#}
        if (multiSearch !=='') query += 'search=' + multiSearch + "&"

        if (ordering === '' || ordering === null || ordering=== undefined ){
        } else {
              order === ordering ? order = "-" +ordering : order = ordering
        }


        $(".sorting_item_name").html("í’ˆëª…â–½")
        $(".sorting_item_code").html("í’ˆë²ˆâ–½")
        $(".sorting_item_nice").html("ë‚˜ì´ìŠ¤ë²ˆí˜¸â–½")
        switch(order){
            case "name":
                $(".sorting_item_name").html("í’ˆëª…â–¼")
                break;
            case "-name":
                $(".sorting_item_name").html("í’ˆëª…â–²")
                break;
            case "code":
                $(".sorting_item_code").html("í’ˆë²ˆâ–¼")
                break;
            case "-code":
                $(".sorting_item_code").html("í’ˆë²ˆâ–²")
                break;
            case "nice_number":
                $(".sorting_item_nice").html("ë‚˜ì´ìŠ¤ë²ˆí˜¸â–¼")
                break;
            case "-nice_number":
                $(".sorting_item_nice").html("ë‚˜ì´ìŠ¤ë²ˆí˜¸â–²")
                break;
            default:
                break;
        }
       query += "ordering=" + order + "&";

        if ($('#stockzero').is(":checked"))
            {
                // urls = "/items/calculatezero/"
                query += 'stockzero=True'+ "&";
            }else{
                // urls = "/items/calculate/"
                query += 'stockzero=False'+"&"
            }
        console.log("query   : "  +  query)
        api_gp("/items/calculate/" + query + "/", "GET", {}, (done) => {
            main_table_draw(done)
        });
    }

    function material_status_search_submit(e) {
        e.preventDefault();
        order = ""
        nation1.page = 1;
        main_click_id = null;
        search();
        return false;
    }

    function main_table_draw(done) {
        console.log(done);

        let data = done.results;
        let num = (((nation1.page * 1) - 1) * nation_data1["page_size"]) + 1;

        let rows = "";
        for (let i = 0; i < data.length; i++) {
            let item = data[i];
            //console.log("item", item);

            let row = "<tr id='" + item.id + "' style='cursor:pointer;'>";
            row += "<td class=''>" + (num + i) + "</td>";
            row += "<td data-item='item-brand'>" + (item.brand_name ? item.brand_name : "") + "</td>";
            row += "<td data-item='item-item_group'>" + (item.item_group_name ? item.item_group_name : "") + "</td>";
            row += "<td data-item='item-name' title='" + item.name + "'>" + (item.name.length > 10 ? item.name.slice(0,10) + "..." : item.name) + "</td>"; // í’ˆëª…
            row += "<td data-item='item-code' title='" + item.code + "'>" + (item.code.length > 10 ? item.code.slice(0,10) + "..." : item.code) + "</td>"; // í’ˆë²ˆ
            row += "<td data-item='item-nice_number'>" + (item.nice_number ? item.nice_number : "") + "</td>"; // ë‚˜ì´ìŠ¤
            row += "<td data-item='item-detail'>" + (item.detail ? item.detail : "") + "</td>"; // ë‚˜ì´ìŠ¤
            row += "<td data-item='item-shape'>" + (item.shape ? item.shape : "") + "</td>"; // í˜•íƒœ
            row +=
                "<td data-item='item-item-division'>" +
                (item.division_name ? item.division_name : "") +
                "</td>"; // ìì¬êµ¬ë¶„
            {#row +=#}
            {#    "<td data-item='item-item-division'>" +#}
            {#    (item.unit_name ? item.unit_name : "") +#}
            {#    "</td>"; // ë‹¨ìœ„#}
            row +=
                "<td data-item='in-receive-amount'>" +
                (item.in_receive_amount ? item.in_receive_amount.toLocaleString() : 0) +
                "</td>"; // ì…í•˜ìˆ˜ëŸ‰
            row +=
                "<td data-item='in-faulty-amount'>" +
                (item.in_faulty_amount ? item.in_faulty_amount.toLocaleString() : 0) +
                "</td>"; // ì…í•˜ë¶ˆëŸ‰ìˆ˜ëŸ‰
            row +=
                "<td data-item='in-amount'>" +
                (item.in_receive_amount - item.in_faulty_amount).toLocaleString() +
                "</td>"; // ì…ê³ ìˆ˜ëŸ‰
            row +=
                "<td data-item='out-amount'>" +
                (item.in_out_amount ? item.in_out_amount.toLocaleString() : 0) +
                "</td>"; // ì¶œê³ ìˆ˜ëŸ‰
            row +=
                "<td data-item='rein-amount'>" +
                (item.in_rein_amount ? item.in_rein_amount.toLocaleString() : 0) +
                "</td>"; // ë°˜ì…ìˆ˜ëŸ‰
            row +=
                "<td data-item='adjust-amount'>" +
                item.in_adjust_amount
                "</td>"; // ì¡°ì • ìˆ˜ëŸ‰
            row += "<td data-item='actual-amount'>" + (item.stock ? item.stock.toLocaleString() : 0) + "</td>"; // í˜„ì¬ê³ 
            row += "<td data-item='item-location'>" + "<input class='btn-primary' type='button' value='ì €ì¥ì°½ê³ ' onclick='showLocationModal(" + item.id + ")'/>" + "</td>"; // í˜„ì¬ê³ 
            row += "</tr>";

            rows += row;
        }
        spinner();

        nation1.nation_display(done);
        $("#material-status-tbody").html(rows);
        document.querySelectorAll("#material-status-tbody tr td").forEach(element=>
        element.classList.add("align-middle")
        )

        if (main_click_id != null) {
            $("#material-status-tbody #" + main_click_id).addClass('clicked');
        }

        // table click highlight
        $("#material-status-tbody tr").on("click", function () {
            $(this).parent().find("tr").removeClass("clicked");
            $(this).addClass("clicked");

            main_click_id = $(this).attr("id");
        });
    }

    function showLocationModal(id) {
        main_click_id = id;

        if (main_click_id === undefined || main_click_id === null) {
            alert("ì¬ê³ ëŸ‰ì„ ì¡°íšŒí•  í’ˆëª©ì´ ì„ íƒë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. í’ˆëª© ì„ íƒ í›„ì— ì¡°íšŒí•˜ì‹œê¸° ë°”ëë‹ˆë‹¤.")
            return;
        }

        $("#locationModal").modal()
        api_gp(`/material/location/?item=${main_click_id}`, 'GET', {}, (data) => {
            //console.log("data");
            //console.log(data);
            itemAmountAtLocations = data;
            let location = '';
            for (let key in itemAmountAtLocations) {
                if (itemAmountAtLocations.hasOwnProperty(key)) {
                    let value = itemAmountAtLocations[key];

                    location += `<div class="col-sm-6 mb-4 col-xl-3" id="${key}" onclick="selectLocation('${key}','${value}')">
                                    <div class="card">
                                        <div class="card-body">
                                            <div class="row no-gutters align-items-center">
                                                <div class="col mr-2">
                                                    <div class="text-xs font-weight-bold text-uppercase mb-1"> ${key} </div>
                                                    <div class="h5 mb-0 font-weight-bold text-gray-800">${value}</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>`
                }
            }
            $("#selectLocation").html(location)
        });

         api_gp("/items/" + main_click_id, "GET", {}, (done) => {
            itemInform = done
             //console.log(itemInform)
             let row = `
            <tr>
            <td>${itemInform.brand_name !== undefined ? itemInform.brand_name :""}</td>
            <td>${itemInform.item_group_name !== undefined ? itemInform.item_group_name :""}</td>
            <td title = '${itemInform.name}'>${itemInform.name.length > 10 ? itemInform.name.slice(0,10) + "..." : itemInform.name}</td>
            <td title = '${itemInform.code}'>${itemInform.code.length > 10 ? itemInform.code.slice(0,10) + "..." : itemInform.code}</td>
            <td>${itemInform.nice_number !== undefined ? itemInform.nice_number :""}</td>
            <td>${itemInform.detail !== null ? itemInform.detail :""}</td>
            <td>${itemInform.shape !== undefined ? itemInform.shape :""}</td>
            <td>${itemInform.stock !== undefined ? itemInform.stock :""}</td>
            </tr>
            `
             $("#itemInform").html(row)
        });
    }
       function selectLocation(key, value) {
        if (value <= 0) {
            alert("ì¬ê³ ë¥¼ ì„ íƒí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤")
            return
        }
        document.querySelectorAll("#selectLocation .col-sm-6").forEach(element =>
            element.classList.remove("text-info"))
        document.querySelector(`#${key}`).classList.add("text-info")
        $("#location").val(`${key}`)
    }

    function material_status_init() {
        function make_dropdown(data, selectors) {
            let list = "<option value=''>ì„ íƒ ë° ê²€ìƒ‰</option>";
            let distinct = [];
            for (let i = 0; i < data.length; i++) {
                let item = data[i];
                if (selectors.includes('.bom-dropdown')) {
                    list += "<option value='" + item.id + "'>" + item.bom_name + "</option>";
                } else if (selectors.includes('.item-code-dropdown')) {
                    list += "<option value='" + item.id + "'>" + item.code + "</option>";
                } else if (selectors.includes('.nice_number-dropdown')) {
                    list += "<option value='" + item.id + "'>" + item.nice_number + "</option>";
                } else if (selectors.includes('.item-name-dropdown')) {
                    if (distinct.indexOf(item.name) === -1) {
                        list += "<option value='" + item.id + "'>" + item.name + "</option>";
                        distinct.push(item.name);
                    }
                }else {
                    list += "<option value='" + item.id + "'>" + item.name + "</option>";
                }
            }
            $(selectors).html(list);
            $(selectors).select2({width: '100%'});
        }

        // êµ¬ë§¤ì²˜
        api_gp('/customers_select/', 'GET', {}, (data) => {
            make_dropdown(data, '.customer-dropdown');
        });

        // ìì¬êµ¬ë¶„
        api_gp('/codes_select/?group=118&enable=true', 'GET', {}, (data) => {
            make_dropdown(data, '.item-division-dropdown');
        });

        // ëª¨ë¸
        api_gp('/codes_select/?group=116&enable=true', 'GET', {}, (data) => {
            make_dropdown(data, '.model-dropdown');
        });

        // í’ˆë²ˆ, í’ˆëª…
        {#api_gp('/items_select/', 'GET', {}, (data) => {#}
        api_gp('/items_part/', 'GET', {}, (data) => {
            make_dropdown(data, '.item-code-dropdown');
            make_dropdown(data, '.item-code-dropdown-search');
            make_dropdown(data, '.item-name-dropdown');
            make_dropdown(data, '.item-name-dropdown-search');
            make_dropdown(data, '.nice_number-dropdown-search');
        });

        api_gp('/codes_select/?group=107&enable=true', 'GET', {}, (data) => {
            make_dropdown(data, '.location-dropdown');
        });

        // ë¸Œëœë“œ
        api_gp('/codes_select/?group=127&enable=true', 'GET', {}, (data) => {
            make_dropdown(data, '.brand-dropdown');
            make_dropdown(data, '.brand-dropdown-search');
        });

        // ì œí’ˆêµ°
        api_gp('/codes_select/?group=128&enable=true', 'GET', {}, (data) => {
            make_dropdown(data, '.item_group-dropdown');
            make_dropdown(data, '.item_group-dropdown-search');
        });

        // ìì¬ë¶„ë¥˜
        api_gp('/codes_select/?group=118&enable=true', 'GET', {}, (data) => {
            make_dropdown(data, '.item_division-dropdown-search');
        });

    }

    function material_status_get_form_data() {
        let data = {};
        columns.forEach((item) => {
            if (item === "enable")
                data[item] =
                    $('#material_status_main-form [name="' + item + '"]').val() ===
                    "ì‚¬ìš©";
            else
                data[item.replace(/-/gi, "_")] = $(
                    '#material_status_main-form [name="' + item + '"]'
                ).val();
        });

        // TODO:
        data.item = data["item_code"];

        return data;
    }

    function resetLocation() {
                document.querySelectorAll("#selectLocation .col-sm-6").forEach(element =>
            element.classList.remove("text-info"))

    }
    function enrollLocation(){
        let enrollData = {};
        let location_in = $("#location_in").val();
        let location_out = $("#location_out").val();
        let item_amount = $("#item-amount").val();
        enrollData = {location_in: location_in, location_out: location_out, item_amount: item_amount, item: main_click_id};
        api_gp("/material/location_move/", "POST", enrollData, (data)=>{
            alert(data.location_out + " ì—ì„œ " + data.location_in + " ìœ¼ë¡œ ì¬ê³  ì´ë™ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.");
        })
        $("#locationModal").modal(false);
        resetLocation();
    }

    function spinner() {
        $("#spinner").remove();
    }

</script>
{#{% endblock %}#}
</body>
</html>
