{% load static %}
<!-- Modal -->
<form id="weekly_report_add_form">
    {% csrf_token %}
    <div class="modal fade" id="weekly_report_add_modal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel1" style="font-family: Pretendard;">주간업무보고 등록</h5>
                    <button
                            type="button"
                            class="btn-close"
                            data-bs-dismiss="modal"
                            aria-label="Close"></button>
                </div>
                <div class="modal-body">

                    <div class="col-md-12 col-12 mb-3">
                        <label for="write_day" class="form-label">* 작성일</label>
                        <input type="text" class="form-control flatpickr-input active" placeholder="연-월-일" id="write_day" required>
                    </div>

                    <div class="col-md-12 col-12 mb-3">
                        <label for="work_category" class="form-label">* 분류</label>
                        <input type="text" class="form-control" id="work_category" placeholder="카테고리를 입력해주세요." required>
                    </div>

                    <div class="col-md-12 col-12 mb-3">
                       <label for="project_name" class="form-label">* 프로젝트</label>
                        <select class="form-control" id="project_name" name="project_name">
                            {% for obj in projects %}
                                <option class="form-control" value="{{ obj.id }}">{{ obj.pjname }}</option>
                            {% endfor %}
                        </select>
                       <!--<input type="text" class="form-control" id="project_name" placeholder="프로젝트를 입력해주세요." required>-->
                    </div>

                    <div class="col-md-12 col-12 mb-3">
                        <label for="report_task" class="form-label">* TASK</label>
                        <input type="text" class="form-control" id="report_task" placeholder="TASK를 입력해주세요." required>
                    </div>

                    <div class="col-md-12 col-12 mb-3">
                        <label for="work_content" class="form-label">* 실행 항목</label>
                        <input type="text" class="form-control" id="work_content" placeholder="업무내용을 입력해주세요." required>
                    </div>

                    <div class="col-md-12 col-12 mb-3">
                        <label for="detail_task_result" class="form-label">* 진행 상태</label>
                        <select class="form-control" id="task_status" name="task_status">
                            <option value="P">진행</option>
                            <option value="R">중지</option>
                            <option value="H">보류</option>
                            <option value="F">완료</option>
                        </select>
                    </div>

                    <div class="col-md-12 col-12 mb-3">
                        <label for="task_start_date" class="form-label">* 시작일</label>
                        <input type="text" class="form-control flatpickr-input active" placeholder="연-월-일" id="task_start_date" required>
                    </div>

                    <div class="col-md-12 col-12 mb-3">
                        <label for="task_end_date" class="form-label">* 종료일</label>
                        <input type="text" class="form-control flatpickr-input active" placeholder="연-월-일" id="task_end_date" required>
                    </div>

                    <div class="col-md-12 col-12 mb-3">
                        <label for="detail_task_result" class="form-label">* 소요일</label>
                        <input type="number" class="form-control" id="duration_days" placeholder="소요일을 입력해주세요." required>
                    </div>

                    <div class="col-md-12 col-12 mb-3">
                        <label for="notied_point" class="form-label">* 참고 사항</label>
                        <input type="text" class="form-control" id="notied_point" placeholder="참고사항을 입력해주세요." required>
                    </div>

                    <div class="col-md-12 col-12 mb-3" style="display: none">
                        <label for="detail_task_result" class="form-label">* 담당 PM</label>
                        <input class="form-control" id="pm_name" name="pm_name">
                    </div>

                </div>


                <div class="modal-footer">
                    <button type="submit" class="btn btn-primary" id="submit_add_btn">확인</button>
                    <button type="submit" class="btn btn-primary" style="display: none" id="approval_edit_btn">수정</button>
                    <button type="button" class="btn btn-label-secondary" data-bs-dismiss="modal">취소</button>
                </div>

            </div>
        </div>
    </div>
</form>
<script>
    $(function () {
        $("#write_day, #task_start_date, #task_end_date").flatpickr({
            dateFormat: 'Y-m-d',
            enableTime: false
        });
    });

    $("#submit_add_btn").click(function (e) {
        e.preventDefault();

        var write_day = $('#write_day').val();
        var work_category = $('#work_category').val();
        var project_name = $('#project_name').val();
        var report_task = $('#report_task').val();
        var work_content = $('#work_content').val();
        var task_status = $('#task_status option:selected').text();
        var task_start_date = $('#task_start_date').val();
        var task_end_date = $('#task_end_date').val();
        var duration_days = $('#duration_days').val();
        var notied_point = $('#notied_point').val();
        var pm_name = $('#pm_name').val('');

        weekly_report_table.row.add([
            '',
            write_day,
            work_category,
            project_name,
            report_task,
            work_content,
            task_status,
            task_start_date,
            task_end_date,
            duration_days + '일',
            notied_point,
            pm_name
        ]).draw(false);

        $('#weekly_report_add_modal').modal('hide');
        $('#weekly_report_add_form')[0].reset();
    });

    function weekly_report_edit(subtask_id) {

    }
</script>
