<!DOCTYPE html>
<html>
<header>{% include "header.html" %}</header>
<body style="overflow: hidden;">
{% load static %}
{{ it.media }}
{#<title>í’ˆëª© ê¸°ì¤€ì •ë³´ê´€ë¦¬</title>#}

<!-- ê²€ìƒ‰ -->
<div class="card m-2">
    <div class="card-body p-2">
        <!-- ë³¸ë¬¸ -->
        <div
                class="content-search row no-gutters align-items-center content-input-group"
        >
            <div class="content-title col-1 align-self-stretch">ê²€ìƒ‰</div>
            <div class="col-11">
                <div class="row no-gutters">
                    <div class="content-input-group col-3 px-0">
                        <div class="content-input-group-header">
                            <label>í’ˆë²ˆ</label>
                        </div>
                        <div class="content-input-group-input">
                            {{ it.it_code_sch }}
                            {#                            <input class="form-control" id="code_sch"/>#}
                        </div>
                    </div>
                    <div class="content-input-group col-3 px-0">
                        <div class="content-input-group-header">
                            <label>í’ˆëª…</label>
                        </div>
                        <div class="content-input-group-input">
                            {{ it.it_name_sch }}

                        </div>
                    </div>
                    <div class="content-input-group col-3 px-0">
                        <div class="content-input-group-header">
                            <label>ìì¬ë¶„ë¥˜</label>
                        </div>
                        <div class="content-input-group-input">
                            {{ it.it_division_sch }}

                        </div>
                    </div>
                    <div class="col-1 px-0">
                        <button class="btn button-search rounded-0 w-100 h-100" type="button" onclick="search_click();">
                            ê²€ìƒ‰
                        </button>
                    </div>
                </div>
            </div>
                        <div class="content-input-group col-4 mt-2">
                            <div class="content-input-group-input input-group">
                                <input class="form-control" id="multiSearch" placeholder="ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”
                                "/>
                              <div class="input-group-append">
                         <button class="btn btn-outline-secondary" type="button" onclick="nation1.page =1; search();"> ğŸ”</button>

                            </div>
                            </div>
                        </div>

        </div>
    </div>
</div>

<!-- ë‚´ìš© -->
<div class="card m-2">
    <div class="row no-gutters card-body p-2">
        <!-- ë³¸ë¬¸ -->
        <form id="item_master" class="content-content w-100">
            {% csrf_token %}
            <div class="row no-gutters w-100 mb-2">
                <div class="col-1 content-title">ë‚´ìš©</div>
                <div class="col-11" id="detail_itemmaster">
                    <div class="row no-gutters">
                        <div class="content-input-group col-3">
                            <div class="content-input-group-header">
                                <label>í’ˆë²ˆ<strong>*</strong></label>
                            </div>
                            <div class="content-input-group-input">
                                <input class="form-control" id="code"/>
                            </div>
                        </div>
                        <div class="content-input-group col-3">
                            <div class="content-input-group-header">
                                <label>í’ˆëª…<strong>*</strong></label>
                            </div>
                            <div class="content-input-group-input">
                                <input class="form-control" id="name"/>
                            </div>
                        </div>
                        <div class="content-input-group col-3">
                            <div class="content-input-group-header">
                                <label>í’ˆëª…ìƒì„¸</label>
                            </div>
                            <div class="content-input-group-input">
                                <input class="form-control" id="detail"/>

                            </div>
                        </div>
                        <div class="content-input-group col-3 px-0">
                            <div class="content-input-group-header">
                                <label>ìì¬ë¶„ë¥˜</label>
                            </div>
                            <div class="content-input-group-input">
                            {{ it.it_division_add }}

                            </div>
                        </div>
                    </div>
                    <div class="row no-gutters">
                        <div class="content-input-group col-3">
                            <div class="content-input-group-header">
                                <label>ëª¨ë¸</label>
                            </div>
                            <div class="content-input-group-input">
                                <input class="form-control" id="detail"/>

                            </div>
                        </div>
                        <div class="content-input-group col-3">
                            <div class="content-input-group-header">
                                <label>ë‹¨ìœ„</label>
                            </div>
                            <div class="content-input-group-input">
                               {{ it.it_unit_add }}
                            </div>
                        </div>
                    <div class="content-input-group col-3 px-0">
                        <div class="content-input-group-header">
                            <label>ê±°ë˜ì²˜</label>
                        </div>
                        <div class="content-input-group-input">
                            {{ it.it_division_add }}

                        </div>
                    </div>
                    <div class="content-input-group col-3">
                            <div class="content-input-group-header">
                                <label>ì•ˆì „ì¬ê³ ìˆ˜ëŸ‰</label>
                            </div>
                            <div class="content-input-group-input">
                                <input class="form-control" id="safe_amount" />
                            </div>
                        </div>
                    </div>
                    <div class="row no-gutters">
                        <div class="content-input-group col-3">
                            <div class="content-input-group-header">
                                <label>ìˆ˜ìˆ˜ë£Œìœ¨</label>
                            </div>
                            <div class="content-input-group-input">
                                <input class="form-control" id="fee_rate"/>
                            </div>
                        </div>
                        <div class="content-input-group col-3">
                            <div class="content-input-group-header">
                                <label>ë¹„ê³ </label>
                            </div>
                            <div class="content-input-group-input">
                                <input class="form-control" id="etc"/>
                            </div>
                        </div>
                        <div class="content-input-group col-3">
                            <div class="content-input-group-header">
                                <label>MOQ</label>
                            </div>
                            <div class="content-input-group-input">
                                <input class="form-control" id="moq"/>
                            </div>
                        </div>
                        <div class="content-input-group col-3">
                            <div class="content-input-group-header">
                                <label title="í‘œì¤€ë‹¨ê°€ : ì…ê³ ëœ ë§ˆì§€ë§‰ ë‹¨ê°€ &#10;ê´€ë¦¬ìë§Œ ìˆ˜ì •í•˜ì‹œê¸° ë°”ëë‹ˆë‹¤">í‘œì¤€ë‹¨ê°€</label>
                            </div>
                            <div class="content-input-group-input">
                                <input title="í‘œì¤€ë‹¨ê°€ : ì…ê³ ëœ ë§ˆì§€ë§‰ ë‹¨ê°€ &#10;ê´€ë¦¬ìë§Œ ìˆ˜ì •í•˜ì‹œê¸° ë°”ëë‹ˆë‹¤" class="form-control"
                                       id="standard_price" onkeyup="_chkNumber(this, 2)"/>
                            </div>
                        </div>
                    </div>
                    <div class="row no-gutters">

                        <div class="content-input-group col-3">
                            <div class="content-input-group-header">
                                <label>TYPE</label>
                            </div>
                            <div class="content-input-group-input">
                                <input class="form-control" id="bom_division" disabled/>
                            </div>
                        </div>
                        <div class="content-input-group col-3">
                            <div class="content-input-group-header">
                                <label>QR</label>
                            </div>
                            <div class="content-input-group-input">
                                <input class="btn button-custom2 w-100" id="qr"
                                       type="button" onclick="show_qr_print($(this).val())"/>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row no-gutters w-100 justify-content-end">
                {% comment %}<div class="col-5 d-flex ml-auto">
                    <form id="excel_upload_form" class="ml-auto ml-2 col-8" method="POST" enctype="multipart/form-data" action="{% url 'basic_information_items_excelupload' %}">{% csrf_token %}
                        <div class="form-box">
                            <div class="input-group mb-3">
                                <div class="custom-file">
                                    <input name="excel" type="file" class="custom-file-input" id="excel" style="width: 300px;" required>
                                    <label id="excel_label" class="custom-file-label" for="excel" aria-describedby="upload_excel">ì—‘ì…€ íŒŒì¼ì„ ì„ íƒí•˜ì„¸ìš”.</label>
                                </div>
                            </div>
                        </div>
                    </form>
                    <div class="col-4 ml-2">
                        <button
                                id="upload_excel"
                                class="btn button-custom2 w-100"
                                type="button"
                                onclick="excel_upload();"
                        >
                            ì—‘ì…€ ì—…ë¡œë“œ
                        </button>
                    </div>
                </div>{% endcomment %}
                <div class="col-1 px-0 mr-2">
                    <button
                            type="button"
                            class="btn button-custom2 w-100"
                            onclick="refresh_data()"
                    >
                        ì´ˆê¸°í™”
                    </button>
                </div>
                <div class="col-1 px-0 mr-2">
                    <button
                            type="button"
                            class="btn button-custom2 w-100"
                            onclick="qr_update()"
                    >
                        QRìƒì„±
                    </button>
                </div>
                <div class="col-1 px-0 mr-2">
                    <button
                            type="button"
                            class="btn button-custom2 w-100"
                            onclick="item_add()"
                    >
                        ì¶”ê°€
                    </button>
                </div>
                <div class="col-1 px-0 mr-2">
                    <button
                            class="btn button-custom2 w-100"
                            type="button"
                            onclick="modify()"
                    >
                        ìˆ˜ì •
                    </button>
                </div>
                <div class="col-1 px-0">
                    <button
                            class="btn button-custom2 w-100"
                            type="button"
                            onclick="remove()"
                    >
                        ì‚­ì œ
                    </button>
                </div>
            </div>
        </form>
    </div>
</div>

<!-- í…Œì´ë¸” -->
<div class="card m-2">
    <div class="row no-gutters card-body p-2">
        <!-- ë³¸ë¬¸ -->
        <div class="content-table col-12" style="overflow-y: hidden; height:420px;">
            <table
                    id="item_table"
                    class="table table-sm text-center"
                    style="min-width: 1300px"
            >
                <thead>
                <tr>
                    <th rowspan="2">ìˆœë²ˆ</th>
                    <th class="sorting_item_name" onclick="search('name')">í’ˆëª…</th>
                    <th class="sorting_item_code" onclick="search('code')">í’ˆë²ˆ</th>
                    <th class="sorting_detail" onclick="search('detail')">í’ˆëª…ìƒì„¸</th>
                    <th rowspan="2">ëª¨ë¸</th>
                    <th rowspan="2">ìì¬ë¶„ë¥˜</th>
                    <th rowspan="2">ë‹¨ìœ„</th>
                    <th rowspan="2">ê±°ë˜ì²˜</th>
                    <th rowspan="2">MOQ</th>
                    <th rowspan="2">ì•ˆì „ì¬ê³ ìˆ˜ëŸ‰</th>
                    <th rowspan="2">ë¹„ê³ </th>
                    <th rowspan="2">í‘œì¤€ë‹¨ê°€</th>
                    <th rowspan="2">TYPE</th>
                    <th rowspan="2">ìˆ˜ìˆ˜ë£Œìœ¨</th>
                </tr>
                </thead>
                <tbody id="item_tbody"></tbody>
            </table>

            <div class="row no-gutters d-flex justify-content-center" id="item_nation">
            </div>

        </div>
    </div>
</div>

<script src="{% static 'js/api_codemaster.js' %}" type="text/javascript"></script>
<script src="{% static 'js/api_item.js' %}" type="text/javascript"></script>
<script src="{% static 'js/api_BOMmaster.js' %}" type="text/javascript"></script>
<script src="{% static 'js/api_paginations.js' %}" type="text/javascript"></script>

<script>
    // ê²€ìƒ‰ì¸ì - í’ˆë²ˆ, í’ˆëª…, ìì¬ë¶„ë¥˜(ac)
    let it_code_sch = null;
    let it_nice_number_sch = null;
    let it_brand_sch = null;
    let it_item_group_sch = null;
    let it_division_sch = null;

    // add í•­ëª© - ìì¬ë¶„ë¥˜, ëª¨ë¸, ë‹¨ìœ„, ê±°ë˜ì²˜, ìš©ê¸°íƒ€ì…, ì¹¼ë¼êµ¬ë¶„, í’ˆì¢…êµ¬ë¶„ë¶„
    let it_click_div_id = null;
    let it_click_div_name = null;

    let it_click_model_id = null;
    let it_click_model_name = null;

    let it_click_unit_id = null;
    let it_click_unit_name = null;

    let it_click_cu_id = null;
    let it_click_cu_name = null;

    let it_click_con_id = null;
    let it_click_con_name = null;

    let it_click_color_id = null;
    let it_click_color_name = null;

    let it_click_kind_id = null;
    let it_click_kind_name = null;

    let it_click_brand_id = null;
    let it_click_brand_name = null;

    let it_click_item_group_id = null;
    let it_click_item_group_name = null;

    let it_click_purchase_from_id = null;
    let it_click_purchase_from_name = null;
    let it_click_purchase_from_code = null;

    let it_click_purchase_from2_id = null;
    let it_click_purchase_from2_name = null;
    let it_click_purchase_from2_code = null;

    let it_click_purchase_from3_id = null;
    let it_click_purchase_from3_name = null;
    let it_click_purchase_from3_code = null;

    // ì•„ì´í…œ pk
    let item_id_idx = null;
    let item_name = null;

    let item_qr_path = null;

    let page1_size = 10;

    let nation_data1 = {
        cname: 'nation1',  // ì¸ìŠ¤í„´ìŠ¤ ëª…ê³¼ ì¼ì¹˜í•´ì•¼í•¨
        table_id: 'item_nation',
        range: 5,
        page_size: page1_size,
    };

    let nation1 = new Pnations(nation_data1, search);  // ì¸ìŠ¤í„´ìŠ¤ ëª…

    $(function () {
        $("input[name=excel]").change(function (){
            $('#excel_label').text($(this).val());
        });

        $("#id_it_customer_add_code").on("select2:select", ()=>{
            let selector = $("#id_it_customer_add_code option:selected");
            console.log(selector.val());
            $("#id_it_customer_add").val(selector.val()).trigger("change");
        });
        $("#id_it_customer_add").on("select2:select", ()=>{
            let selector = $("#id_it_customer_add option:selected")
            console.log(selector.val());
            $("#id_it_customer_add_code").val(selector.val()).trigger("change")
        })

        $("#id_it_customer2_add_code").on("select2:select", ()=>{
            let selector = $("#id_it_customer2_add_code option:selected")
            $("#id_it_customer2_add").val($(selector).val()).trigger("change")

        })
        $("#id_it_customer2_add").on("select2:select", ()=>{
            let selector = $("#id_it_customer2_add option:selected")
            $("#id_it_customer2_add_code").val($(selector).val()).trigger("change")

        })

        $("#id_it_customer3_add_code").on("select2:select", ()=>{
            let selector = $("#id_it_customer3_add_code option:selected")
            $("#id_it_customer3_add").val($(selector).val()).trigger("change")

        })
        $("#id_it_customer3_add").on("select2:select", ()=>{
            let selector = $("#id_it_customer3_add option:selected")
            $("#id_it_customer3_add_code").val($(selector).val()).trigger("change")

        })

        set_naming();
        search();
        //refresh();
        // Table export
    });

    function excel_upload() {
        let form = new FormData();

        let fileSelector = document.getElementById('excel');
        let file = (fileSelector.files[0] ? fileSelector.files[0] : null);

        form.append("csrfmiddlewaretoken", '{{ csrf_token }}')
        form.append("excel", file)

        api_excel_upload(form, () => {
            alert("ì„±ê³µì ìœ¼ë¡œ ë“±ë¡í•˜ì˜€ìŠµë‹ˆë‹¤.");

            refresh_data();
        });
    }

    function api_excel_upload(allData, done_callback) {
        let v = allData.values();

        for (let value of v){
            console.log(value);
        }

        $.ajax({
            type: "POST",
            url: "/basic_informations/items/excelupload/",
            headers: {
                "Authorization": get_token()
            },
            processData: false,
            contentType: false,
            data: allData
        })
            .done(function () {
                done_callback();
            })
            .fail(handle_error);
    }

    function set_naming() {
        let enterprise_name = get_userinfo().enterprise_name;
        if (enterprise_name == '(ì£¼)ê±´ê°•ìƒí™œì—°êµ¬ì†Œ') {
            $("#n_model1").text("ì œí’ˆêµ°");
            $("#n_model2").text("ì œí’ˆêµ°");

            $("#n_container").text("í˜•íƒœ");
            $("#n_color").text("Scent");
            $("#n_type").text("ë¸Œëœë“œ");
        }
    }

    function refresh() {
        location.href = "/basic_information/items/";
    }

    {% comment %}
    function refresh() {
        init_drop_down();
        item_search();
    }
    {% endcomment %}

    function search_click() {
        nation1.page = 1;

        it_code_sch = $('#id_it_code_sch').val();
        it_nice_number_sch = $('#id_it_nice_number_sch').val();
        it_brand_sch = $('#id_it_brand_sch').val();
        it_item_group_sch = $('#id_it_item_group_sch').val();
        it_division_sch = $('#id_it_division_sch').val();

        search();
    }

    let order = ""

    function search(ordering) {

        if (ordering === '' || ordering === null || ordering=== undefined ){
        } else {
              order === ordering ? order = "-" +ordering : order = ordering
        }

        $(".sorting_item_name").html("í’ˆëª…â–½")
        $(".sorting_item_code").html("í’ˆë²ˆâ–½")
        $(".sorting_detail").html("í’ˆëª…ìƒì„¸â–½")
        switch(order){
            case "name":
                $(".sorting_item_name").html("í’ˆëª…â–¼")
                break;
            case "-name":
                $(".sorting_item_name").html("í’ˆëª…â–²")
                break;
            case "code":
                $(".sorting_item_code").html("í’ˆë²ˆâ–¼")
                break;
            case "-code":
                $(".sorting_item_code").html("í’ˆë²ˆâ–²")
                break;
            case "nice_number":
                $(".sorting_detail").html("í’ˆëª…ìƒì„¸â–¼")
                break;
            case "-nice_number":
                $(".sorting_detail").html("í’ˆëª…ìƒì„¸â–²")
                break;
            default:
                break;
        }

        let query = "?page_size=" + page1_size + "&page=" + nation1.page +"&";

        query += "ordering=" + order + "&";

        if (it_code_sch == '' || it_code_sch == null || it_code_sch == 'ì„ íƒ ë° ê²€ìƒ‰') {
        } else {
            query += "&it_code_sch=" + it_code_sch;
        }
        if (it_nice_number_sch == '' || it_nice_number_sch == null || it_nice_number_sch == 'ì„ íƒ ë° ê²€ìƒ‰') {
        } else {
            query += "&it_nice_number_sch=" + it_nice_number_sch;
        }
        if (it_brand_sch == '' || it_brand_sch == null || it_brand_sch == 'ì„ íƒ ë° ê²€ìƒ‰') {
        } else {
            query += "&it_brand_sch=" + it_brand_sch;
        }
        if (it_item_group_sch == '' || it_item_group_sch == null || it_item_group_sch == 'ì„ íƒ ë° ê²€ìƒ‰') {
        } else {
            query += "&it_item_group_sch=" + it_item_group_sch;
        }
        if (it_division_sch == '' || it_division_sch == null || it_division_sch == 'ì„ íƒ ë° ê²€ìƒ‰') {
        } else {
            query += "&it_div_sch=" + it_division_sch;
        }

        let multiSearch = $("#multiSearch").val()
        if (multiSearch !=='') query += '&total_search=' + multiSearch;

        console.log(query);
        {#loading_start();#}
        api_gp("/basic_information/items_read/" + query, "GET", {}, (done) => {
            console.log(done);
            {#loading_finish();#}
            draw_items_table(done);
        });
    }


    function draw_items_table(done) {

        console.table(done);

        let data = done.results;
        let num = (((nation1.page * 1) - 1) * nation_data1["page_size"]) + 1;

        let rows = "";
        for (let i = 0; i < data.length; i++) {
            let item = data[i];

            let row = "<tr id='" + item.id + "' style='cursor:pointer;'>";
            row += "<td>" + (num + i) + "</td>";  // ìˆœë²ˆ

            row += "<td title='" + item.code + "'>" + (item.code.length > 10 ? item.code.slice(0,10) + "..." : item.code) + "</td>";  // í’ˆë²ˆ
            row += "<td class='d-none' data-item='code'>" +item.code + "</td>";  // í’ˆë²ˆ
            row += "<td title='" + item.name + "'>" + (item.name.length > 10 ? item.name.slice(0,10) + "..." : item.name) + "</td>";  // í’ˆëª…
            row += "<td class='d-none' data-item='name'>"  + item.name + "</td>";  // í’ˆëª…
            row += "<td data-item='detail'>" + nullapply(item.detail) + "</td>";  // í’ˆëª…ìƒì„¸
            row += "<td data-item='model_name'>" + nullapply(item.model_name) + "</td>";  // ëª¨ë¸
            row += "<td data-item='division' " +
                "property='" + (item.division_id ? item.division_id : "") + "'>" +
                (item.division_id ? item.division_name : "") + "</td>";  // ìì¬ë¶„ë¥˜

            row += "<td data-item='unit_name'>" + nullapply(item.unit_name) + "</td>";  // ë‹¨ìœ„
            row += "<td data-item='purchase_from' property='" + (item.purchase_from_id ? item.purchase_from_id : "") + "'>" +
                (item.purchase_from_name ? item.purchase_from_name : "") + "</td>";  // ê±°ë˜ì²˜1
            row += "<td style='display: none' data-item='purchase_from_code' property='" + (item.purchase_from_id ? item.purchase_from_id : "") + "'>" +
                (item.purchase_from_code ? item.purchase_from_code : "") + "</td>";  // ê±°ë˜ì²˜1
            row += "<td data-item='moq'>" + nullapply(item.moq) + "</td>";  // moq
            row += "<td data-item='safe_amount'>" + nullapply(item.safe_amount) + "</td>"; //ì•ˆì „ì¬ê³ ìˆ˜ëŸ‰
            row += "<td data-item='etc'>" + (item.etc ? item.etc : "") + "</td>";  // ë¹„ê³ 
            row += "<td data-item='standard_price'>" +
                (item.standard_price ? item.standard_price.toLocaleString() : 0) + "</td>";  // í‘œì¤€ë‹¨ê°€
            row += "<td data-item='type'>" +
                (item.type ? item.type : 0) + "</td>";  // íƒ€ì…
            row += "<td data-item='fee_rate'>" + Number(item.fee_rate) +"%"+ "</td>"; //ìˆ˜ìˆ˜ë£Œìœ¨
            row += "</tr>";
            rows += row;
        }

        nation1.nation_display(done);

        $('#item_tbody').html(rows);

        console.log('ì°í˜€ìˆëŠ” id ê°’ì€?');
        console.log(item_id_idx);
        console.log($("#" + item_id_idx));

        if (item_id_idx != null) {
            $("#" + item_id_idx).addClass('clicked');
        }

        $('#item_tbody > tr').on('click', function () {

            // table click highlight
            $(this).parent().find('tr').removeClass('clicked');
            $(this).addClass('clicked');

            item_id_idx = $(this).attr("id");
            item_name = $(this).find("[data-item='name']").text();

            $("#code").val($(this).find("[data-item='code']").text());  // í’ˆë²ˆ
            $("#name").val($(this).find("[data-item='name']").text());  // í’ˆëª…
            $("#brand").val($(this).find("[data-item='brand']").text());  // ë¸Œëœë“œ
            $("#family").val($(this).find("[data-item='family']").text());  // ì œí’ˆêµ°
            $("#shape").val($(this).find("[data-item='shape']").text());  // í˜•íƒœ
            $("#nice").val($(this).find("[data-item='nice']").text());  // ë‚˜ì´ìŠ¤ë²ˆí˜¸
            $("#detail").val($(this).find("[data-item='detail']").text());// í’ˆëª…ìƒì„¸

            it_click_div_id = $(this).find("[data-item='division']").attr("property");
            it_click_div_name = $(this).find("[data-item='division']").text();

            it_click_model_id = $(this).find("[data-item='model']").attr("property");
            it_click_model_name = $(this).find("[data-item='model']").text();

            it_click_unit_id = $(this).find("[data-item='unit']").attr("property");
            it_click_unit_name = $(this).find("[data-item='unit']").text();

            {#it_click_cu_id = $(this).find("[data-item='customers']").attr("property");#}
            {#it_click_cu_name = $(this).find("[data-item='customers']").text();#}

            it_click_con_id = $(this).find("[data-item='container']").attr("property");
            it_click_con_name = $(this).find("[data-item='container']").text();

            it_click_color_id = $(this).find("[data-item='color']").attr("property");
            it_click_color_name = $(this).find("[data-item='color']").text();

            it_click_kind_id = $(this).find("[data-item='type']").attr("property");
            it_click_kind_name = $(this).find("[data-item='type']").text();

            it_click_brand_id = $(this).find("[data-item='brand']").attr("property");
            it_click_brand_name = $(this).find("[data-item='brand']").text();

            it_click_item_group_id = $(this).find("[data-item='item_group']").attr("property");
            it_click_item_group_name = $(this).find("[data-item='item_group']").text();

            it_click_purchase_from_id = $(this).find("[data-item='purchase_from']").attr("property");
            it_click_purchase_from_name = $(this).find("[data-item='purchase_from']").text();
            it_click_purchase_from_code = $(this).find("[data-item='purchase_from_code']").text();

            it_click_purchase_from2_id = $(this).find("[data-item='purchase_from2']").attr("property");
            it_click_purchase_from2_name = $(this).find("[data-item='purchase_from2']").text();
            it_click_purchase_from2_code = $(this).find("[data-item='purchase_from2_code']").text();

            it_click_purchase_from3_id = $(this).find("[data-item='purchase_from3']").attr("property");
            it_click_purchase_from3_name = $(this).find("[data-item='purchase_from3']").text();
            it_click_purchase_from3_code = $(this).find("[data-item='purchase_from3_code']").text();




            let option1 = new Option(it_click_div_name, it_click_div_id, true, true);
            $('#id_it_division_add').append(option1).trigger('change');

            let option2 = new Option(it_click_model_name, it_click_model_id, true, true);
            $('#id_it_model_add').append(option2).trigger('change');

            let option3 = new Option(it_click_unit_name, it_click_unit_id, true, true);
            $('#id_it_unit_add').append(option3).trigger('change');

            {#let option4 = new Option(it_click_cu_name, it_click_cu_id, true, true);#}
            {#$('#id_it_customer_add').append(option4).trigger('change');#}

            let option5 = new Option(it_click_con_name, it_click_con_id, true, true);
            $('#id_it_container_add').append(option5).trigger('change');

            let option6 = new Option(it_click_color_name, it_click_color_id, true, true);
            $('#id_it_color_add').append(option6).trigger('change');

            let option7 = new Option(it_click_kind_name, it_click_kind_id, true, true);
            $('#id_it_kind_add').append(option7).trigger('change');

            let option8 = new Option(it_click_brand_name, it_click_brand_id, true, true);
            $('#id_it_brand').append(option8).trigger('change');

            let option9 = new Option(it_click_item_group_name, it_click_item_group_id, true, true);
            $('#id_it_item_group').append(option9).trigger('change');

            let option10 = new Option(it_click_purchase_from_name, it_click_purchase_from_id, true, true);
            $('#id_it_customer_add').append(option10).trigger('change');
            let option10_1 = new Option(it_click_purchase_from_code, it_click_purchase_from_id, true, true);
            $('#id_it_customer_add_code').append(option10_1).trigger('change');

            let option11 = new Option(it_click_purchase_from2_name, it_click_purchase_from2_id, true, true);
            $('#id_it_customer2_add').append(option11).trigger('change');
            let option11_1 = new Option(it_click_purchase_from2_code, it_click_purchase_from2_id, true, true);
            $('#id_it_customer2_add_code').append(option11_1).trigger('change');

            let option12 = new Option(it_click_purchase_from3_name, it_click_purchase_from3_id, true, true);
            $('#id_it_customer3_add').append(option12).trigger('change');
            let option12_1 = new Option(it_click_purchase_from3_code, it_click_purchase_from3_id, true, true);
            $('#id_it_customer3_add_code').append(option12_1).trigger('change');




            $("#fee_rate").val($(this).find("[data-item='fee_rate']").text());// ìˆ˜ìˆ˜ë£Œìœ¨
            $("#etc").val($(this).find("[data-item='etc']").text());// ë¹„ê³ 
            $("#standard_price").val($(this).find("[data-item='standard_price']").text());// í‘œì¤€ë‹¨ê°€
            $("#bom_division").val($(this).find("[data-item='bom_division']").text());// BOM êµ¬ë¶„
            $("#qr").val($(this).find("[data-item='qr']").text());// qr

            {#$("#brand").val($(this).find("[data-item='brand']").text());// brand#}
            {#$("#item_group").val($(this).find("[data-item='item_group']").text());// item_group#}
            $("#nice_number").val($(this).find("[data-item='nice_number']").text());// nice_number
            $("#shape").val($(this).find("[data-item='shape']").text());// shape
            $("#safe_amount").val($(this).find("[data-item='safe_amount']").text());// safe_amount

            item_qr_path = $(this).find("[data-item='qr']").text();
        });
    }

    function qr_update() {
        if (!item_id_idx) {
            alert('í’ˆëª©ì„ ì„ íƒí•´ ì£¼ì„¸ìš”.');
            return;
        }

        let data = {
            csrfmiddlewaretoken: '{{ csrf_token }}',
            pk: item_id_idx,
        }

        console.log(data);

        api_gp('/basic_information/items_qr_update/', 'post', data, (done) => {
            alert('QR ìƒì„±ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.');
            search();

            console.log(done);

            $("#qr").val(done.qr_path);
            $("#bom_division").val(done.bom_division_name);

        });

        {% comment %}
        api_item_update_qr(item_id_idx, (done) => {
            alert('QR ìƒì„±ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.');
            search();
            //refresh();
        });
        {% endcomment %}
    }


    function item_add() {
        if ($('#code').val() == "") {
            alert("í’ˆë²ˆì„ ì…ë ¥í•´ ì£¼ì„¸ìš”.");
            return;
        }

        if ($('#name').val() == "") {
            alert("í’ˆëª…ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”.");
            return;
        }

        let data = get_data();
        api_gp("/basic_information/items_create/", "POST", data, (done) => {
            nation1.page = 1;
            item_id_idx = done.id;
            item_name = done.name;

            alert("ì¶”ê°€í•˜ì˜€ìŠµë‹ˆë‹¤.");

            search();
            $("#qr").val(done.qr_path);
            $("#bom_division").val(done.bom_division_name);
        });
    }


    function modify() {
        if (item_id_idx == null) {
            alert("ìˆ˜ì •í•  í–‰ì„ ì„ íƒí•´ ì£¼ì„¸ìš”.");
            return;
        }

        if ($('#code').val() == "") {
            alert("í’ˆë²ˆì„ ì…ë ¥í•´ ì£¼ì„¸ìš”.");
            return;
        }

        if ($('#name').val() == "") {
            alert("í’ˆëª…ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”.");
            return;
        }

        if ($('#bom_division').val() == "BOM") {
            let enterprise_name = get_userinfo().enterprise_name;
            if (enterprise_name == '(ì£¼)ê±´ê°•ìƒí™œì—°êµ¬ì†Œ') {
                alert("[BOM TYPE]ì€ [ë ˆì‹œí”¼ ê´€ë¦¬] > [ë ˆì‹œí”¼ í˜•ì‹]ì—ì„œ ìˆ˜ì •í•˜ì„¸ìš”.");
            } else {
                alert("[BOM TYPE]ì€ [BOM ê´€ë¦¬] > [BOM í˜•ì‹ ìƒì„±]ì—ì„œ ìˆ˜ì •í•˜ì„¸ìš”.");
            }

            return;
        }

        let data = get_data();
        console.log(data);

        api_gp('/basic_information/items_update/', 'post', data, (done) => {
            alert("ìˆ˜ì •í–ˆìŠµë‹ˆë‹¤..");

            search();

        });
    }


    function remove() {
        if (item_id_idx == null) {
            alert("ì‚­ì œí•  í’ˆëª©ì„ ì„ íƒí•´ ì£¼ì„¸ìš”.");
            return;
        }

        if ($('#bom_division').val() == "BOM") {
            alert("[BOM TYPE]ì€ [BOM ê´€ë¦¬] > [BOM í˜•ì‹ ìƒì„±]ì—ì„œ ì‚­ì œí•˜ì„¸ìš”.");
            return;
        }

        let allData = {
            csrfmiddlewaretoken: '{{ csrf_token }}',
            pk: item_id_idx,
            qr_path: item_qr_path,// pk
        }

        let del = confirm(
            "í’ˆëª©: " + item_name + "ì„(ë¥¼) ì‚­ì œ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?"
        );

        if (del) {
            api_gp('/basic_information/items_delete/', 'post', allData, (done_callback) => {
                alert("ì‚­ì œí•˜ì˜€ìŠµë‹ˆë‹¤.");
                nation1.page = 1;

                refresh_data();
                search();

            });
        }
    }

    function show_qr_print(_imgurl) {

        var url = "/material/qr_print/?param1=";
        url = url + _imgurl;
        var name = "QR Print";
        var option = "width=1000px, height=1000px, location=no";
        window.open(url, name, option);

    }

    function api_item_update_qr(id_data, done_callback) {
        $.ajax({
            type: "POST",
            url: "/basic_information/items_qr_update/",
            headers: {
                "Authorization": get_token()
            },
            data: {
                id: id_data
            },
        })
            .done(function (json) {
                done_callback(json);
            })
            .fail(handle_error);
    }


    function get_data() {
        let standard_price = $("#standard_price").val().replace(/,/g, "");// í‘œì¤€ë‹¨ê°€

        console.log('í‘œì¤€ë‹¨ê°€ëŠ”');
        console.log(standard_price)
        console.log($('#id_it_customer2_add').val())
        console.log($('#id_it_customer3_add').val())

        if (standard_price == '' || standard_price == null) {
            standard_price = '0';
        }


        return {
            csrfmiddlewaretoken: '{{ csrf_token }}',
            pk: item_id_idx,

            code: $("#code").val(),  // í’ˆë²ˆ
            name: $("#name").val(),  // í’ˆëª…
            detail: $("#detail").val(),  // í’ˆëª…ìƒì„¸

            item_division: $('#id_it_division_add').val(),  // ìì¬ë¶„ë¥˜
            unit: $('#id_it_unit_add').val(),  // ë‹¨ìœ„
            model: $('#id_it_model_add').val(),  // ëª¨ë¸
            container: $('#id_it_container_add').val(),  // ìš©ê¸°íƒ€ì…
            color: $('#id_it_color_add').val(),  // ì¹¼ë¼êµ¬ë¶„
            type: $('#id_it_kind_add').val(),  // í’ˆì¢…êµ¬ë¶„
            purchase_from: $('#id_it_customer_add').val(), // ê±°ë˜ì²˜
            purchase_from2: $('#id_it_customer2_add').val(), // ê±°ë˜ì²˜
            purchase_from3: $('#id_it_customer3_add').val(), // ê±°ë˜ì²˜


            etc: $("#etc").val(),  // ë¹„ê³ 
            standard_price: standard_price,  // í‘œì¤€ë‹¨ê°€

            brand_id: $('#id_it_brand').val(),
            item_group_id: $('#id_it_item_group').val(),
            nice_number: $('#nice_number').val(),
            shape: $('#shape').val(),
            safe_amount: $('#safe_amount').val(),

            qr_path: '',
        };
    }

    // êµ³ì´?
    function refresh_search_data() {
        $("#code_sch").val("");
        $("#name_sch").val("");
        //$("#division_sch").val(null).trigger("change");
    }


    function refresh_data() {
        //refresh_search_data();

        $("#code").val("");  // í’ˆë²ˆ
        $("#name").val("");  // í’ˆëª…
        $("#detail").val("");  // í’ˆëª…ìƒì„¸
        $("#shape").val("");  // í’ˆëª…ìƒì„¸

        // 7ê°œì˜ ac, íƒ€ì…, qr
        let option1 = new Option('', '', true, true);
        $('#id_it_division_add').append(option1).trigger('change');

        let option2 = new Option('', '', true, true);
        $('#id_it_model_add').append(option2).trigger('change');

        let option3 = new Option('', '', true, true);
        $('#id_it_unit_add').append(option3).trigger('change');

        {#let option4 = new Option('', '', true, true);#}
        {#$('#id_it_customer_add').append(option4).trigger('change');#}

        let option5 = new Option('', '', true, true);
        $('#id_it_container_add').append(option5).trigger('change');

        let option6 = new Option('', '', true, true);
        $('#id_it_color_add').append(option6).trigger('change');

        let option7 = new Option('', '', true, true);
        $('#id_it_kind_add').append(option7).trigger('change');

        let option8 = new Option('', '', true, true);
        $('#id_it_brand').append(option8).trigger('change');

        let option9 = new Option('', '', true, true);
        $('#id_it_item_group').append(option9).trigger('change');

        let option10 = new Option('', '', true, true);
        $('#id_it_customer_add').append(option10).trigger('change');

        let option10_1 = new Option('', '', true, true);
        $('#id_it_customer_add_code').append(option10_1).trigger('change');

        let option11 = new Option('', '', true, true);
        $('#id_it_customer2_add').append(option11).trigger('change');

        let option11_1 = new Option('', '', true, true);
        $('#id_it_customer2_add_code').append(option11_1).trigger('change');

        let option12 = new Option('', '', true, true);
        $('#id_it_customer3_add').append(option12).trigger('change');

        let option12_1 = new Option('', '', true, true);
        $('#id_it_customer3_add_code').append(option12_1).trigger('change');

        $("#bom_division").val("");
        $("#qr").val("");

        $("#etc").val("");  // ë¹„ê³ 
        $("#standard_price").val(0);  // í‘œì¤€ë‹¨ê°€
        $("#safe_amount").val(0);  // í‘œì¤€ë‹¨ê°€

        item_id_idx = null;
        $('#item_tbody').find('tr').removeClass('clicked');
    }

</script>

</body>
</html>
