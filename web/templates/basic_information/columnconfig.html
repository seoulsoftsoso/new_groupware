<!DOCTYPE html>
<html>
<header>
    {% include "header.html" %}

    <style>
        tr.selected {
            background-color: #ccc;
        }
        th {
          white-space: nowrap;
          overflow: hidden;
          text-overflow: ellipsis;
          max-width: 100px;
        }
    </style>
</header>


<body style="overflow: hidden;">

{% load static %}
{{ ep.media }}
<div class="col-12">
    <div class="main-content">
        <div class="main-content-inner">
            <!-- 검색  -->
            <div class="row align-items-center">
                <div class="col-lg-12 col-ml-12 mt-3">
                    <div class="card">

                            <div class="row ml-3">
                                <div class="col-md-3 clearfix">
                                    <div class="form-group">
                                        <label for="example-text-input" class="col-form-label">메뉴목록</label>
                                        <div class="content-input-group-input">
                                        {{ ep.menulist_name_ac }}
                                        </div>
                                    </div>
                                </div>

                                <div class="col-md-1 clearfix">
                    <div class="gradient-buttons ml-1 col-md-3 mt-3">
                        <button type="button" class="btn btn-primary" onclick="search_click();"><i class="ti-search"></i>  검색</button>
                    </div>
                </div>
                                <div class="col-md-6 mt-4 ml-3"></div>
<div class="col-md-1 mt-4">
                    <ul class="notification-area pull-right">
                        <li class="settings-btn">
                            <i class="ti-settings"></i>
                        </li>
                    </ul>
                </div>
                            </div>

                    </div>

                </div>
                </div>
            </div>
            <!-- 테이블  -->
            <div class="row no-gutters ml-4 mr-4">

                    <div class="card">
                        <div class="card-body" style="width: 100%">

                            <table id="main_table_sm-112" class="table table-hover table-striped table-bordered display nowrap" style="width: 100%; table-layout: fixed;">
                                <thead>
                                    <tr class="table-active">

                                        {% for item in column %}
                                            <th>{{ item.label }}</th>
                                        {% endfor %}
                                    </tr>
                                </thead>
                                <tbody>
                                {% for item in column %}
                                    <tr>
                                        <th></th>
                                        <th class="th-sm" style="word-wrap: break-word;"  >{{ item.label|default_if_none:'' }}</th>
                                        <th class="th-sm"  >{{ item.pre_label|default_if_none:'' }}</th>
                                    <th class="th-sm"  >{{ item.tag|default_if_none:'' }}</th>
                                    <th class="th-sm"  >{{ item.type|default_if_none:'' }}</th>
                                    <th class="th-sm"  >{{ item.class_name|default_if_none:'' }}</th>
                                    <th class="th-sm"  >{{ item.event|default_if_none:'' }}</th>
                                    <th class="th-sm"  >{{ item.position }}</th>
                                    <th class="th-sm"  >{{ item.use_flag }}</th>
                                    <th class="th-sm"  >{{ item.visual_flag }}</th>
                                    <th class="th-sm"  >{{ item.excel_flag }}</th>

                                    </tr>
                                        {% endfor %}
                                </tbody>

                            </table>

                        </div>
                    </div>

            </div>
        </div>
    </div>
</div>


<!-- offset area start -->
<div class="offset-area">
    <div class="offset-close"><i class="ti-close"></i></div>
    <ul class="nav offset-menu-tab">
        <li><a class="active" data-toggle="tab" href="#detail_item">편집</a></li>
        <li></li>
    </ul>
    <div class="offset-content tab-content">
        <div id="detail_item" class="tab-pane fade in show active">
            <div class="col-12">
                <div class="card">
                    <div class="card-body">
                        <form class="needs-validation" id="item_master_form">
                            <div class="form-row">
                                {% for item in column %}
                                    {% if item.edit_flag %}
                                        <div class="col-md-6 mb-3">
                                        <label for=""><strong>{{ item.pre_label|default_if_none:'' }}</strong>{{ item.label }}</label>
                                        {% if item.tag == "input" %}


                                    <input type="text" class="{{ item.class_name|safe }}" name="{{ item.label_en|safe }}{{ item.code|safe }}" autocomplete="off"/>

                                        {% elif item.tag == "select" %}

                                            <select class="{{ item.class_name|safe }}">
                                            <option value="1">사용</option>
                                            <option value="0">미사용</option>
                                            </select>
                                        {% elif item.tag == "select2" %}

                                            <div class="content-input-group-input">

                                        </div>
                                    {% endif %}
                                        </div>
                                    {% endif %}
                                        {% endfor %}
                            </div>
                        </form>
                        <div class="gradient-buttons pull-right">
                            <div class="btn btn-primary mr-3" id="item_add-sm-4"> 등 록 </div>
                            <div class="btn btn-primary mr-3" id="item_edit-sm-4"> 수 정 </div>
                            <div class="btn btn-primary mr-3" id="item_delete-sm-4"> 삭 제 </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


</body>
<script src="{% static 'srtdash/assets/js/scripts.js' %}" type="text/javascript"></script>
<script>
    let main_table = null;
    let re_column = []

    {% for item in column %}
        {% if item.label_en != "No" %}
        re_column.push("result." +  "{{ item.label_en }}")
        {% endif %}
    {% endfor %}
    console.log(re_column);
    $(document).ready(function() {

        main_table = $('#main_table_sm-112').DataTable({

            "columnDefs": [
                    {
                        targets: 0,
                        render: function(data, type, row, meta) {
                            return meta.row + 1;
                        }
                    }
                ]
        })



    });

    function search_click() {

        let menu_id = $('#id_menulist_name_ac').val()
        let query = "?menu_id=" + menu_id
        api_gp("/basic_information/columnview/" + query, "GET", {}, (done) => {
            console.log(done)
            draw_column_table(done);
        });
    }

    function draw_column_table(done) {
        main_table.rows().remove().draw();
        console.log(formatData(done));
        main_table.rows.add(formatData(done)).draw();
    }

    function formatData(results) {

        return results.map((result, index) =>  [
            index +1,
            result.label,
            result.pre_label,
            result.tag,
            result.type,
            result.class_name,
            result.event,
            result.position,
            result.use_flag,
            result.visual_flag,
            result.excel_flag
            //re_column


            {% comment %}re_column.forEach((item) => {
                item
                //console.log(item)
                }){% endcomment %}
          ]);
    }

</script>
</html>