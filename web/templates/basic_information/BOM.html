<!DOCTYPE HTML>
<html>
<header>
    {% include "header.html" %}
</header>
<body style="overflow: hidden;">


<!-- {#{% extends 'index.html' %}#} -->
{% load static %}
<!-- {#{% block title %}#}
{#    <title>BOM í˜•ì‹ ìƒì„±</title>#}
{#{% endblock title %}#}
{##}
{#{% block content %}#} -->

<div class="spinner" id="spinner">
    <img src="../../../static/img/spinner.gif" width="150px" height="150px"/>
</div>

<div class="show-error" style="display:none;"></div>
<div>
    <!-- ê²€ìƒ‰ -->
    <div class="card m-2">
        <div class="card-body p-2">
            <!-- ë³¸ë¬¸ -->
            <div class="content-search row no-gutters align-items-center">
                <form class="col-11" method="GET" id="BOM_main-form" onsubmit="return BOM_search_submit(event)">
                    <div class="row no-gutters">
                        <div class="content-input-group col-3">
                            <div class="content-input-group-header">
                                <label>ë¸Œëœë“œ</label>
                            </div>
                            <div class="content-input-group-input">
                                <select class="form-control brand-dropdown" id="search_brand">
                                </select>
                            </div>
                        </div>
                        <div class="content-input-group col-3">
                            <div class="content-input-group-header">
                                <label>ì œí’ˆêµ°</label>
                            </div>
                            <div class="content-input-group-input">
                                <select class="form-control item_group-dropdown" id="search_item_group">
                                </select>
                            </div>
                        </div>

                        <div class="content-input-group col-3">
                            <div class="content-input-group-header">
                                <label>í’ˆë²ˆ</label>
                            </div>
                            <div class="content-input-group-input">
                                <select class="form-control bom_number-dropdown" id="search_item-code">
                                </select>
                            </div>
                        </div>
                              <div class="content-input-group col-3">
                            <div class="content-input-group-header">
                                <label>ë‚˜ì´ìŠ¤ë²ˆí˜¸</label>
                            </div>
                            <div class="content-input-group-input">
                                <select class="form-control item_nice-dropdown" id="search_item-nice">
                                </select>
                            </div>

                    </div>






                        </div>
                              <div class="row no-gutters">
                        <div class="content-input-group col-4 mt-2">
                            <div class="content-input-group-input input-group">
                                <input class="form-control" id="multiSearch" placeholder="ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”
                                "/>
                              <div class="input-group-append">
                         <button class="btn btn-outline-secondary" onclick="nation1.page =1; BOM_search();"> ğŸ”</button>

                            </div>
                            </div>
                            </div>
                        </div>
                </form>
                  <div class="col-1 px-0">
                      <button class="btn button-search w-100" form="BOM_main-form">ê²€ìƒ‰</button>
                  </div>
            </div>
        </div>
    </div>

    <!-- í…Œì´ë¸” -->
    <div class="card m-2">
        <div class="row no-gutters card-body p-2">
            <div class="col-12 px-0">
                <!-- ë³¸ë¬¸ -->
                <div class="content-table col-12 px-0" style="overflow-x:auto; overflow-y:hidden; height: 402px;">
                    <table id="BOM_data-table-up" class="table table-sm text-center">
                        <thead>
                        <tr>
                            <th>ìˆœë²ˆ</th>
                            <th>ë¸Œëœë“œ</th>
                            <th>ì œí’ˆêµ°</th>
                            <th>í’ˆëª…</th>
                            <th>í’ˆë²ˆ</th>
                            <th>ë‚˜ì´ìŠ¤ë²ˆí˜¸</th>
                            <th>í’ˆëª…ìƒì„¸</th>
                            <th>í˜•íƒœ</th>

                            <th data-tableexport-display="none">ì„¤ê³„ë„ë©´</th>

                            <th>ìµœì´ˆ ë“±ë¡ì¼</th>
                            <th>ìµœì´ˆ ë“±ë¡ì</th>
                                <th>ìµœì¢… ë³€ê²½ì¼</th>
                            <th>ìµœì¢… ë³€ê²½ì</th>

                        </tr>
                        </thead>
                        <tbody id="BOMmaster_tbody">
                        </tbody>
                    </table>

                    <div class="row no-gutters d-flex justify-content-center" id="item_nation"
                         style="margin-top: -20px;">
                    </div>
                </div>
            </div>

        </div>
    </div>
    <div class="card m-2">
        <div class="card-body p-2">
            <!-- ë³¸ë¬¸ -->
            <div class="content-search row no-gutters align-items-center" id="BOM_identity">
                <div class="content-title col-1 align-self-stretch" id="n_bom_generate">
                    BOM ìƒì„±
                </div>
                <form class="col-11">
                    {% csrf_token %}
                    <div class="row no-gutters">
                        <div class="content-input-group col-3">
                            <div class="content-input-group-header">
                                <label>ë¸Œëœë“œ</label>
                            </div>
                            <div class="content-input-group-input">
                                <select class="form-control brand-dropdown" id="brand" name="brand" placeholder="" maxlength="15">
                                </select>
                            </div>
                        </div>
                        <div class="content-input-group col-3">
                            <div class="content-input-group-header">
                                <label>ì œí’ˆêµ°</label>
                            </div>
                            <div class="content-input-group-input">
                                <select class="form-control item_group-dropdown" name="item_group">
                                </select>
                            </div>
                        </div>
                        <div class="content-input-group col-3">
                            <div class="content-input-group-header">
                                <label>í’ˆëª…<strong>*</strong></label>
                            </div>
                            <div class="content-input-group-input">
                                <input class="form-control product_name" name="product_name" id="product_name">
                            </div>
                        </div>
                        <div class="content-input-group col-3">
                            <div class="content-input-group-header">
                                <label>í’ˆë²ˆ<strong>*</strong></label>
                            </div>
                            <div class="content-input-group-input">
                                <input class="bom_number     form-control" id="bom_number" name="bom_number"/>
                            </div>
                        </div>
                        </div>
                    <div class="row no-gutters">
                        <div class="content-input-group col-3">
                            <div class="content-input-group-header">
                                <label>ë‚˜ì´ìŠ¤ë²ˆí˜¸<strong>*</strong></label>
                            </div>
                            <div class="content-input-group-input">
                                <input
                                        class="form-control item-nice"
                                        name="item-nice"
                                        id="item-nice"
                                />
                            </div>
                        </div>
                        <div class="content-input-group col-3">
                            <div class="content-input-group-header">
                                <label>í’ˆëª…ìƒì„¸</label>
                            </div>
                            <div class="content-input-group-input">
                                <input class="form-control" name="item-detail" id="item-detail">
                            </div>
                        </div>
                        <div class="content-input-group col-3">
                            <div class="content-input-group-header">
                                <label>í˜•íƒœ</label>
                            </div>
                            <div class="content-input-group-input">
                                <input class="form-control" name="item-shape" id="item-shape"/>
                            </div>
                        </div>
                       <div class="content-input-group col-3">
                            <div class="content-input-group-header">
                                <label>ìì¬ë¶„ë¥˜</label>
                            </div>
                            <div class="content-input-group-input">
                                <select
                                        class="form-control item-division-dropdown"
                                        name="item_division"
                                        id="item-division"
                                ></select>
                            </div>`
                        </div>
                        </div>
                    <div class="row no-gutters">
                        <div class="content-input-group col-3">
                            <div class="content-input-group-header">
                                <label>ì•ˆì „ì¬ê³ ìˆ˜ëŸ‰</label>
                            </div>
                            <div class="content-input-group-input">
                                <input
                                        class="form-control amount"
                                        name="amount"
                                        id="amount"
                                />
                            </div>
                        </div>
                        <div class="content-input-group col-3">
                            <div class="content-input-group-header">
                                <label>ë‹¨ê°€</label>
                            </div>
                            <div class="content-input-group-input">
                                <input
                                        class="form-control item-price"
                                        name="item-price"
                                        id="item-price"
                                />
                            </div>
                        </div>
                        <div class="content-input-group col-3">
                            <div class="content-input-group-header">
                                <label>ê±°ë˜ì²˜</label>
                            </div>
                            <div class="content-input-group-input">
                                <select
                                        class="form-control customer-dropdown"
                                        name="customer"
                                        id="customer"
                                ></select>
                            </div>
                        </div>
                        <div class="content-input-group col-3">
                            <div class="content-input-group-header">
                                <label>ì„¤ê³„ë„ë©´</label>
                            </div>
                            <div class="content-input-group-input" style="border: #bebebe solid 1px; ">
                                <input type="file" id="file-selector" class="fs-selector" name="file" style="line-height: 24px;"
                                       accept=".pdf" onchange='chk_file_type(this)'>

                                <button type="button" class="btn button-custom2 fs-delete"
                                        onClick="uploadFile = ''"
                                        style="width: 48%; float:right;">íŒŒì¼ ì‚­ì œ
                                </button>
                            </div>
                        </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <!-- ë‚´ìš© -->
    <!-- í…Œì´ë¸” -->
    <div class="card m-2">
        <div class="row no-gutters card-body p-2" id="detail_bom_div">
            <!-- ë³¸ë¬¸ -->
            <div class="content-table col-12 mb-2" style="overflow:auto; height:80px;">
                <table id="BOM_data-table-down" class="table table-sm text-center">
                    <thead>
                    <tr class="BOM-list" width="100%">
                        <th style="width:60px;">ìˆœë²ˆ</th>
                        <th>ë¸Œëœë“œ</th>
                        <th>ì œí’ˆêµ°</th>
                        <th>í’ˆëª…</th>
                        <th>í’ˆë²ˆ</th>
                        <th>ë‚˜ì´ìŠ¤ë²ˆí˜¸</th>
                        <th>í’ˆëª…ìƒì„¸</th>
                        <th>í˜•íƒœ</th>
                        <th>ìì¬ë¶„ë¥˜</th>
                        <th>ì•ˆì „ì¬ê³ ìˆ˜ëŸ‰</th>
                        <th>ë‹¨ê°€</th>
                        <th>ê±°ë˜ì²˜</th>
                        <th>ì„¤ê²Œ ë„ë©´</th>
                    </tr>
                    </thead>
                    <tbody id="BOM-data">
                    </tbody>

                </table>
            </div>
            <!-- {#                <div class="col-12 d-flex justify-content-end">#}
                {#                    <div class="col-1 px-0">#}
                {#                        <button class="btn button-custom2 w-100 save" type="button" onclick="confirm()">ì €ì¥</button>#}
                {#                    </div>#}
                {#                </div>#} -->
        </div>

        <div class="row no-gutters justify-content-end m-2">
            <div class="col-1 mr-2">
                <button class="btn button-custom2 w-100" type="button" id='n_bom_save' onclick="BOM_formsubmit()">BOM í˜•ì‹ ì €ì¥</button>
            </div>
            <div class="col-1 mr-2">
                <button class="btn button-custom2 w-100" type="button" id='n_bom_del' onclick="BOM_delete()">BOM ì‚­ì œ</button>
            </div>
        </div>

    </div>
    <div class="row">

    </div>
</div>

<script src="{% static 'js/BOM_create_format.js' %}" type="text/javascript"></script>
<script src="{% static 'js/api_BOMmaster.js' %}" type="text/javascript"></script>
<script src="{% static 'js/api_codemaster.js' %}" type="text/javascript"></script>
<script src="{% static 'js/api_item.js' %}" type="text/javascript"></script>
<script src="{% static 'js/api_paginations.js' %}" type="text/javascript"></script>

<script>
    var bom_id =  null;
    {#let pre_bom_number = "" // BOM ì½”ë“œë²ˆí˜¸ ì €ì¥#}

    let nation_data1 = {
        cname : 'nation1',  // ì¸ìŠ¤í„´ìŠ¤ ëª…ê³¼ ì¼ì¹˜í•´ì•¼í•¨
        table_id: 'item_nation',
        range: 5,
        page_size: 10,
    };

    let nation1 = new Pnations(nation_data1, BOM_search);  // ì¸ìŠ¤í„´ìŠ¤ ëª…
    let uploadFile = ""
    function BOM_load_page() {
        BOM_init();
        BOM_search();

        // Table export
        $(parent.document).find("#excel-export").click(() => {
            init_excel_export($('#BOM_data-table-up'), 'BOMì¡°íšŒ');
            init_excel_export($('#BOM_data-table-down'), 'BOMí•­ëª©');
        });
    }


    function BOM_search_submit(e) {
        e.preventDefault();
        nation1.page = 1;
        bom_id = null;
        reset();

        BOM_search();
        return false;
    }


    function BOM_search() {
          let query = "&page=" + nation1.page

        let code =$("#search_item-code option:selected").text();
        if(code !== "ì„ íƒ ë° ê²€ìƒ‰" && code !== "") query += `&item_code=${code}`
        let brand = $("#search_brand option:selected").text()
        if(brand !== "ì„ íƒ ë° ê²€ìƒ‰" && brand !== "") query += `&brand=${brand}`
        let item_group = $("#search_item_group option:selected").text()
        if(item_group !== "ì„ íƒ ë° ê²€ìƒ‰" && item_group !== "") query += `&item_group=${item_group}`
        let nice_number = $("#search_item-nice option:selected").text()
        if(nice_number !== "ì„ íƒ ë° ê²€ìƒ‰" && nice_number !== "") query += `&nice=${nice_number}`



                let multiSearch = $("#multiSearch").val()





        api_gp(`/bom/master10/?search=${multiSearch}` + query, 'GET', {}, (data) => {
            BOM_load_data(data.results);
            nation1.nation_display(data)
            {#pre_bom_number = "";#}
        });
    }

    // starting point
    $(function () {
        nation1.page = 1
        BOM_init()
        BOM_search()
        spinner()
    });


    function BOM_load_data(data) {
        let tbody = ""

        for (let i = 0; i < data.length; i++) {
            let item = data[i]
            let num = (((nation1.page * 1) - 1) * nation_data1["page_size"]) + 1;

            let tr = `<tr>
                      <td name="id" class="d-none">${nullapply(item.id)}</td>
                      <td>${nullapply(num + i)}</td>
                      <td name='brand' >${nullapply(item.brand?.name)}</td>
                      <td class="d-none" name='brand_id'>${nullapply(item.brand?.id)}</td>
                      <td name='item_group'>${nullapply(item.item_group?.name)}</td>
                      <td class="d-none" name='item_group_id'>${nullapply(item.item_group?.id)}</td>
                      <td name='product_name-tooltip' data-toggle=tooltip title='${item.product_name}'>${nullapply(item.product_name.length > 10 ? item.product_name.slice(0,10) + "..." :item.product_name )}</td>
                      <td name='product_name' class='d-none' >${item.product_name}</td>
                      <td name='bom_number-tooltip' data-toggle=tooltip title='${item.bom_number}'>${nullapply(item.bom_number.length > 10 ? item.bom_number.slice(0,10) + "..." :item.bom_number )}</td>
                      <td name='bom_number' class='d-none' >${item.bom_number}</td>
                      <td name='item-nice-tooltip' data-toggle=tooltip title='${item.nice_number}'>${nullapply(item.nice_number.length > 10 ? item.nice_number.slice(0,10) + "..." :item.nice_number )}</td>
                      <td name='item-nice' class='d-none' >${item.nice_number}</td>
                      <td name='item-detail-tooltip' data-toggle=tooltip title='${item.detail}'>${nullapply(item.detail ? item.detail.length > 10 ? item.detail.slice(0,10) + "..." : item.detail: "")}</td>
                      <td name='item-detail' class='d-none' >${item.detail ? item.detail : ""}</td>
                      <td name='item-shape'>${nullapply(item.shape)}</td>
                      <td name='item-file'>${item.file !== null ? `<a href=${item.file} download=""><img src='../../../static/img/pdf_icon.png' width='20' height='20'/></a>`: ""}</td>
                      <td name='created_at'>${nullapply(item.created_at)}</td>
                      <td name='created_by'>${nullapply(item.created_by)}</td>
                      <td name='updated_at'>${nullapply(item.updated_at)}</td>
                      <td name='updated_by'>${nullapply(item.updated_by)}</td>
                      <td class='d-none' name='item_division'>${nullapply(item.item_division?.name)}</td>
                      <td class='d-none' name='item_division_id'>${nullapply(item.item_division?.id)}</td>
                      <td class='d-none' name='amount'>${nullapply(item.amount)}</td>
                      <td class='d-none' name='item-price'>${nullapply(item.price)}</td>
                      <td class='d-none' name='customer_id'>${nullapply(item.master_customer?.id)}</td>
                      <td class='d-none' name='customer'>${nullapply(item.master_customer?.name)}</td>
                      <td class='d-none' name='file'>${nullapply(item.file)}</td>

                      </tr>`
            tbody += tr;
        }

        $("#BOMmaster_tbody").html(tbody);
        document.querySelectorAll("#BOMmaster_tbody tr").forEach(element =>
        element.addEventListener("click", (e) => {
                document.querySelectorAll("#BOMmaster_tbody tr").forEach(subElement =>
                subElement.classList.remove("clicked")
            )
                element.classList.add("clicked")
            bom_id = element.querySelector("td[name='id']").textContent
            let names = ['brand', 'item_group', 'product_name', 'bom_number', 'item-nice', 'item-detail', 'item-shape', 'item-file', 'created_at', 'created_by', 'updated_at', 'updated_by', 'item_division', 'amount', 'item-price', 'customer', 'file']
            names.forEach(name =>{
                if(name === "brand" || name === "item_group" || name=="customer" || name=="item_division"){
                     $(`#BOM_identity [name=${name}]`).val($(element).find(`[name=${name}_id]`).text()).trigger("change")
                }else{
                $(`#BOM_identity [name=${name}]`).val($(element).find(`[name=${name}]`).text())
            }
            bom_detail_data(element)
            })
        })
    )
    }


    async function bom_detail_data(element){
        let names = ["brand", "item_group", "product_name", "bom_number", "item-nice", "item-detail", "item-shape", "item_division", "amount", "item-price", "customer", "file"]
        let tr = "<tr> <td>1</td>"
        for(let i=0; i<names.length; i++){
            let name = names[i]

            let data =element.querySelector(`td[name=${name}]`).textContent
               if(name === "product_name" || name==="bom_number" || name==="item-nice" || name==="item-detail"){
                    tr += `<td class='d-none' name=${name}>${data}</td>`
                    tr += `<td title='${data}' data-toggle=tooltip >${data.length >10 ? data.slice(0,10)+ "...": data}</td>`
            }else if(name === "file"){
                   if(data !==""){
                    const convertURLtoFile = async (url) => {
                  const response = await fetch(url);
                  const data =await response.blob();
                  const ext = decodeURI(url).split(".").pop(); // url êµ¬ì¡°ì— ë§ê²Œ ìˆ˜ì •í•  ê²ƒ
                  const filename = decodeURI(url).split("/").pop()// url êµ¬ì¡°ì— ë§ê²Œ ìˆ˜ì •í•  ê²ƒ
                  const metadata = { type: `${ext}` };
                  return new File([data], filename, metadata);
                };
                    let urlToFile = await convertURLtoFile(data)
                    uploadFile = urlToFile

                    }else{
                    uploadFile=""
                   }

                    tr += `<td>${data !== "" ? `<a href=${data} download><img src='../../../static/img/pdf_icon.png' width="20" height="20"/></a>`: ""}</td>`

               }else{
            tr += `<td title='${data}' data-toggle=tooltip name=${name}>${data}</td>`
            }
}


        tr += "</tr>"
        $("#BOM-data").html(tr)


    }


    function BOM_init() {
        function make_dropdown(data, selectors) {
            let list = "<option value=''>ì„ íƒ ë° ê²€ìƒ‰</option>";
            for (let i = 0; i < data.length; i++) {
                let item = data[i];
                if (selectors === '.customer-dropdown') {
                    list += "<option value='" + item.id + "'>" + item.name + "</option>";
                } else if (selectors === '.product-dropdown') {
                    list += "<option value='" + item.id + "'>" + item.product_name + "</option>";
                } else if (selectors === '.bom_number-dropdown') {
                    list += "<option value='" + item.id + "'>" + item.bom_number + "</option>";
                }else if (selectors === '.item_nice-dropdown') {
                    list += "<option value='" + item.id + "'>" + item.nice_number + "</option>";
                }
                else{
                    list += "<option value='" + item.id + "'>" + item.name + "</option>";
                }
            }
            $(selectors).html(list);
            $(selectors).select2({width: '100%'});
        }

        // ìƒì‚°ì œí’ˆëª…
        api_gp('/bom/master_select/', 'GET', {}, (data) => {
            make_dropdown(data, '.product-dropdown');
            make_dropdown(data, '.bom_number-dropdown')
            make_dropdown(data, ".item_nice-dropdown")

        });

        // ê³ ê°ì‚¬
        api_gp('/customers_select/', 'GET', {}, (data) => {
            make_dropdown(data, '.customer-dropdown');
        });

        // ìì¬ë¶„ë¥˜
        api_gp("/codes_select/?group=118&enable=true", "GET", {}, (data) => {
            make_dropdown(data, ".division_dropdown");
        });



        // ì¹¼ë¼êµ¬ë¶„ > Sent
        api_gp("/codes_select/?group=119&enable=true", "GET", {}, (data) => {
            make_dropdown(data, ".item_division_dropdown");
        });

        // í’ˆì¢…êµ¬ë¶„ > ë¸Œëœë“œ
        api_gp("/codes_select/?group=115&enable=true", "GET", {}, (data) => {
            make_dropdown(data, ".type_dropdown");
        });

        api_gp("/codes_select/?group=127&enable=true", "GET", {}, (data) => {
            make_dropdown(data, ".brand-dropdown");
        });

        api_gp("/codes_select/?group=128&enable=true", "GET", {}, (data) => {
            make_dropdown(data, ".item_group-dropdown");
        });

          api_gp("/codes_select/?group=118&enable=true", "GET", {}, (data) => {
            make_dropdown(data, ".item-division-dropdown");
        });




    }

    function spinner() {
        $("#spinner").remove();
    }

    function chk_file_type(obj) {

        var file_kind = obj.value.lastIndexOf('.');
        var file_name = obj.value.substring(file_kind + 1, obj.length);
        var file_type = file_name.toLowerCase();

        var check_file_type = new Array();
        check_file_type = ['pdf',];

        if (check_file_type.indexOf(file_type) == -1) {
            alert('PDF íŒŒì¼ë§Œ ì„ íƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');

            $("#file-selector").val("");

            return false;
        } else {
            let ret = fileCheck(obj);
            return ret;
        }
    }

    function fileCheck(file) {
        // ì‚¬ì´ì¦ˆì²´í¬
        var maxSize = 1 * 1024 * 1024 //1MB
        var fileSize = 0;

        fileSize = file.files[0].size;
        if (fileSize > maxSize) {
            alert("íŒŒì¼ ì‚¬ì´ì¦ˆëŠ” 1MB ì´ë‚´ë¡œ ë“±ë¡ ê°€ëŠ¥í•©ë‹ˆë‹¤.");
            return false;
        }
        uploadFile = file.files[0]
        return true;
    }

    function reset() {  // ì„ íƒ ì·¨ì†Œ
        $('#BOM_identity input').val('');
        $('#BOM_identity select').val('').trigger('change');
        $('#BOMmaster_tbody tr').removeClass('clicked');
        bom_id = null;

    }

       function api_bom_post(allData, done_callback) {
        $.ajax({
            type: "POST",
            url: "/bom/master/",
            headers: {
                "Authorization": get_token()
            },
            processData: false,
            contentType: false,
            data: allData
        })
            .done(function (json) {
                done_callback(json);
            })
            .fail(handle_error);
    }
        function api_bom_patch(allData, done_callback) {
        $.ajax({
            type: "Patch",
            url: `/bom/master/${bom_id}/`,
            headers: {
                "Authorization": get_token()
            },
            processData: false,
            contentType: false,
            data: allData
        })
            .done(function (json) {
                done_callback(json);
            })
            .fail(handle_error);
    }

    function BOM_formsubmit(){
        if(bom_id === null){
        api_bom_post(get_data(), (done)=>{
            alert("ì¶”ê°€ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.")
            BOM_search()
        } )
        }
        else{
        api_bom_patch(get_data(), (done)=>{

            alert("ìˆ˜ì •ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤")
            BOM_search()
        })
        }

    }

    function BOM_delete(){
        api_gp(`/bom/master/${bom_id}`, "delete", {}, (done)=>{
            alert("ì‚­ì œì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.")
            BOM_search()
        })
    }

    function get_data(){
            let form = new FormData();
            form.append("bom_number", $("#BOM_identity [name=bom_number]").val())// BOM ì½”ë“œë²ˆí˜¸
            form.append("product_name", $("#BOM_identity [name=product_name]").val())// ìƒì‚°ì œí’ˆëª…
            form.append("detail", $("#BOM_identity [name=item-detail]").val())  // í’ˆëª…ìƒì„¸
            form.append("item_division", $("#BOM_identity [name=item_division] option:selected").val() || "");  // ìì¬ë¶„ë¥˜

            form.append("brand", $('#BOM_identity select[name=brand] option:selected').val() || "");  // ë¸Œëœë“œ
            form.append("item_group", $('#BOM_identity select[name=item_group] option:selected').val() || "");  // ì œí’ˆêµ°
            form.append("nice_number", $('#BOM_identity [name=item-nice]').val() || "")  // ë‚˜ì´ìŠ¤ë²ˆí˜¸
            form.append("shape", $('#BOM_identity [name=item-shape]').val() || "")  // í˜•íƒœ
            form.append("amount", $('#BOM_identity [name=amount]').val() || 0)// ìˆ˜ëŸ‰
            form.append("price", $("#BOM_identity [name=item-price]").val() || 0)  // ë‹¨ê°€
            form.append("master_customer", $("#BOM_identity select[name=customer] option:selected").val() || "");  // ê³ ê°ì‚¬
            form.append("file", uploadFile || "")  // file
            uploadFile = ""
            return form
    }
</script>

<!-- {#{% endblock %}#} -->
</body>
</html>
